extends layout

block styles
  link(rel="stylesheet" type="text/css" href="/vendor/datatables/datatables.bundle.css")

block content
  .container1-page
    // breadcrumb
    .bread-crumb.bgwhite.flex-w.p-l-52.p-r-15.p-t-30.p-l-15-sm
      a.s-text16(href="/")
        | Home
        i.fa.fa-angle-right.m-l-8.m-r-9(aria-hidden="true")
      span.s-text17(href="/products")
        | Products

    // Content page
    section.bgwhite.p-t-55.p-b-65
      .container
        .d-flex.justify-content-end
          if (view == 'grid')
            a.btn.btn-clear.border-primary.rounded-0(href="/products")
                i.fa.fa-th.text-danger
          else
            a.btn.btn-clear.border.rounded-0(href="/products")
                i.fa.fa-th
          if (view == 'table')
            a.btn.btn-clear.border-primary.rounded-0.mx-2(href="?view=table")
              i.fa.fa-list.text-danger
          else
            a.btn.btn-clear.border.rounded-0.mx-2(href="?view=table")
              i.fa.fa-list
          a.btn.btn-clear.border.rounded-0(href="/products/add")
            i.fa.fa-plus.fa-fw
            small Add Product
        .flex-sb-m.flex-w.p-b-35
          .flex-w
            .bo4.of-hidden.w-size12.m-t-5.m-b-5.m-r-10
              select.custom-select.border-0.s-text7.w-100(name="sorting" onchange="filterByCategory(this)")
                option.text-secondary.s-text7(value="all") Sort by category
                option.text-secondary.s-text7(value="all") All
                  each category in categories
                    option.text-secondary.s-text7(value=category.shortName) #{category.name}
            .bo4.of-hidden.w-size12.m-t-5.m-b-5.m-r-10
              select.custom-select.border-0.s-text7.w-100(name="sorting")
                option.text-secondary.s-text7 Price
                option.text-secondary.s-text7 $0.00 - $50.00
                option.text-secondary.s-text7 $50.00 - $100.00
                option.text-secondary.s-text7 $100.00 - $150.00
                option.text-secondary.s-text7 $150.00 - $200.00
                option.text-secondary.s-text7 $200.00+
            .bo4.of-hidden.w-size12.m-t-5.m-b-5.m-r-10
              input.form-control.border-0.s-text7.w-100(type="search" name="search" placeholder="Search")
          span.s-text8.p-t-5.p-b-5
            | Showing #{products.length}â€“#{products.length < 12 ? products.length : 12} of #{totalDocs} results
        // Product
        if (view == 'grid')
          .row
            each product in products
              .col-sm-12.col-md-6.col-lg-3.p-b-50
                // Block2
                .block2
                  .block2-img.wrap-pic-w.of-hidden.pos-relative
                    img(src=hermescraftUrl+"images/products/"+product.images[0].name alt=product.name)
                    .block2-overlay.trans-0-4.d-flex.flex-column.align-items-end.pr-1(style='cursor: pointer' onclick="window.location.href='/products/"+product._id+"'")
                      a.block2-btn-delete.hov-pointer.trans-0-4.mt-2(href="/products/delete/"+product._id role="button" title="Delete")
                        i.fa.fa-trash.fa-2x.text-danger.pr-1(aria-hidden="true")
                        i.fa.fa-trash.fa-2x.text-danger.dis-none(aria-hidden="true")
                      
                      a.block2-btn-update.hov-pointer.trans-0-4.mt-2(href="/products/"+product._id role="button" title="Update")
                        i.fa.fa-edit.fa-2x.text-primary(aria-hidden="true")
                        i.fa.fa-edit.fa-2x.text-primary.dis-none(aria-hidden="true")
                      
                      a.block2-btn-view.hov-pointer.trans-0-4.mt-2(href="/products/delete/"+product._id role="button" title="View")
                        i.fa.fa-external-link.fa-2x.text-light(aria-hidden="true")
                        i.fa.fa-external-link.fa-2x.text-light.dis-none(aria-hidden="true")
                      //
                        .block2-btn-addcart.w-size1.trans-0-4
                          // Button
                          button.flex-c-m.size1.bg4.bo-rad-23.hov1.s-text1.trans-0-4
                            | Add to Cart
                  .block2-txt.p-t-20
                    a.block2-name.dis-block.s-text3.p-b-5(href="product-detail.html")
                      | #{product.name}
                    span.block2-price.m-text6.p-r-5
                      | $#{parseFloat(product.price).toFixed(2)}
          // Pagination
          .pagination.flex-m.flex-w.p-t-26
            each _, i in Array(totalPages)
              if (parseInt(i)+1 == currentPage)
                a.item-pagination.flex-c-m.trans-0-4.active-pagination(href="/products?page="+(parseInt(i)+1)) #{i+1}
              else
                a.item-pagination.flex-c-m.trans-0-4(href="/products?page="+(parseInt(i)+1)) #{i+1}
        
        else 
          .table-responsive
            table.table.table-striped.table-hover#m_table_1
              thead.bg-dark
                tr.s-text15.text-white
                  th Image
                  th Name
                  th Category
                  th Description
                  th Price
                  th Actions
              tbody
                each product in products
                  tr.s-text15
                    td
                      img(src=hermescraftUrl+"images/products/"+product.images[0].name alt=product.name style="width: 50px; height: auto; object-fit: cover")
                    td(style="line-height: 60px") #{product.name}
                    td(style="line-height: 60px") #{product.category}
                    td(style="line-height: 60px") #{product.description}
                    td(style="line-height: 60px") $#{product.price}
                    td.d-flex.justify-content-center.align-items-center(style="height: 80px")
                      .dropdown
                        button.btn.btn-outline-secondary.rounded-circle.p-0.d-flex.align-items-center.justify-content-center(data-toggle='dropdown' style="width: 25px; height: 25px" aria-haspopup="true" aria-expanded="false")
                          i.fas.fa-ellipsis-v
                        .dropdown-menu.dropdown-menu-left
                          ul.nav
                            li.nav-item.border-bottom.w-100
                              a.nav-link.text-primary.py-1(href="/products/"+product._id) 
                                i.fas.fa-edit.fa-fw
                                small Update Product
                            li.nav-item.w-100
                              a.nav-link.text-danger.py-1(href="/products/delete/"+product._id) 
                                i.fas.fa-trash.fa-fw 
                                small Delete Product
          // Pagination
          .pagination.flex-m.flex-w.p-t-26.justify-content-center
            each _, i in Array(totalPages)
              if (parseInt(i)+1 == currentPage)
                a.item-pagination.flex-c-m.trans-0-4.active-pagination(href="/products?view=table&page="+(parseInt(i)+1)) #{i+1}
              else
                a.item-pagination.flex-c-m.trans-0-4(href="/products?view=table&page="+(parseInt(i)+1)) #{i+1}

block scripts
  if (message)
    script(type="text/javascript").
        swal("Success", "#{message}", "success");
  script(type="text/javascript").
      $('.block2-btn-addcart').each(function(){
      var nameProduct = $(this).parent().parent().parent().find('.block2-name').html();
      $(this).on('click', function(e){
        e.stopPropagation();
      swal(nameProduct, "is added to cart !", "success");
      });
      });
      $('.block2-btn-delete').each(function(){
      var nameProduct = $(this).parent().parent().parent().find('.block2-name').html();
      $(this).on('click', function(e){
        e.stopPropagation()
      });
      });
  // ===============================================================================================
  script(src="/js/products.js")
  // ===============================================================================================

  //script(src="/vendor/base/scripts.bundle.js")
  // ===============================================================================================
  //script(src="/vendor/datatables/datatables.bundle.js")
  //script(src="/vendor/datatables/buttons.js")
